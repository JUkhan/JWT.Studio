<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jwt Components</title>
    <script src="Jwt/Resources/?file=jquery.js"></script>
   
</head>
<body>


    <iframe frameborder="0" id="iframe" src="COMPONENT_SITE_URL"></iframe>
    
    <script>
        var load = true;
        $(function () {
            if (window.addEventListener) {
                window.addEventListener("message", listener, false);
            } else {
                attachEvent('onMessage', listener);
            }
            var win=$(window);
            $('#iframe').css({ width: win.width(), height: win.height() });
        });
        function setMessage() {
            load = true;
            document.getElementById('iframe').contentWindow.postMessage("data from Parent", "COMPONENT_SITE_URL");
        }
        function listener(event) {
            console.log(event.data, load);
            if (!load) return;                      
            if (event.data.id === 'jwt') {
                load = false;
                $.get("JwtComponent/IsInstalled?name=" + event.data.comName, function (res) {
                    console.log(res);
                    if (res.msg) {
                        if (confirm('This component is already installed in your site. Do you want to reinstall it?')) {
                            $.get("JwtComponent/Download?name=" + event.data.comName, function (res) { alert(res.msg); load = true; });
                        } else {
                            load = true;
                        }
                    }
                    else {                        
                        $.get("JwtComponent/Download?name=" + event.data.comName, function (res) { alert(res.msg); load = true; });
                    }
                });

            } else {                
                load = true;
            }

        }
    </script>

</body>
</html>
