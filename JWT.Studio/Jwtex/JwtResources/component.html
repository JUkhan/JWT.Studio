<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jwt Components</title>
    <script src="Jwt/Resources/?file=jquery.js"></script>
    <link href="Jwt/Resources/?file=bootstrap.css" rel="stylesheet" />
    <link href="Jwt/Resources/?file=Site.css" rel="stylesheet" />
</head>
<body>
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href="Jwt" class="navbar-brand">App Builder</a>
            </div>
            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li><a href="Jwt">Widget Relation</a></li>
                    <li><a href="JwtEx">Component Builder</a></li>
                    <li class="active"><a href="JwtComponent">Component Showcase</a></li>
                </ul>

            </div>
        </div>
    </div>

    <iframe frameborder="0" id="iframe" src="COMPONENT_SITE_URL"></iframe>
    <div class="overlay">
        <div class="jwt-spinner"><i class="fa fa-refresh fa-spin"></i></i></div>
    </div>
    <script>
        var load = true;
        $(function () {
            if (window.addEventListener) {
                window.addEventListener("message", listener, false);
            } else {
                attachEvent('onMessage', listener);
            }
            var win=$(window);
            $('#iframe').css({ width: win.width(), height: win.height() });
        });
        function setMessage() {
            load = true;
            document.getElementById('iframe').contentWindow.postMessage("data from Parent", "COMPONENT_SITE_URL");
        }
        function listener(event) {           
            if (!load) return;           
            if (event.data.id === 'jwt') {
                load = false;
                $.get("JwtComponent/IsInstalled?name=" + event.data.comName + '&comtype=' + event.data.comType, function (res) {
                    if (res.msg) {
                        if (confirm('This component is already installed in your site. Do you want to reinstall it?')) {
                            overlay(1);
                            $.get("JwtComponent/Download?name=" + event.data.comName + '&comtype=' + event.data.comType, function (res) { overlay(0); alert(res.msg); load = true; });
                        } else {
                            load = true; 
                        }
                    }
                    else {
                        overlay(1);
                        $.get("JwtComponent/Download?name=" + event.data.comName + '&comtype=' + event.data.comType, function (res) { overlay(0); alert(res.msg); load = true; });
                    }
                });

            } else {                
                load = true; overlay(0);
            }

        }
        function overlay(val) {
            val ? $('.overlay').show() : $('.overlay').hide();
        }
    </script>

</body>
</html>
